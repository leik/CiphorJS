<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="../lib/jsunit/app/jsUnitCore.js" type="text/javascript">
        </script>
        <script src="../src/Eve.js" type="text/javascript">
        </script>
        <script src="../src/Reflection.js" type="text/javascript">
        </script>
        <script language="javascript">
          var testObject;
          var testDiv;

          function setUp() {
            //debug("Setting up...");
            testDiv = document.getElementById("test_div");
            Eve.listen("e1").run( function() {
              testDiv.innerText += "[Initial Text]";
            }, 2);
            testObject = Eve.lookup("e1");
          }

          function tearDown() {
            //debug("Tearing down...");
            Eve.forget("e1");
            testObject = null;
            testDiv = null;
          }

          function testGetMethods() {
            debug("Testing \'getMethods\'...");
            assertEquals("Methods Success!",'run,never,fire,using,data',testObject.getClass().getMethods().toString());
          }

          function testGetFields() {
            debug("Testing \'getFields\'...");
            assertEquals("Fields Success!",'_name,_functions',testObject.getClass().getFields().toString());
          }

          function testField() {
            debug("Testing Field...");
            assertEquals(testObject.getClass().getField("_name").getName(),"_name");
            assertEquals(testObject.getClass().getField("_name").getType(testObject),"string");
            assertEquals(testObject.getClass().getField("_name").get(testObject),"e1");
            testObject.getClass().getField("_name").set(testObject,'e2');
            assertEquals(testObject.getClass().getField("_name").get(testObject),"e2");
          }

          function testMethod_1() {
            debug("Testing Method 1'...");
            assertEquals(testObject.getClass().getMethod("using").getName(),"using");
            testObject.getClass().getMethod("using").invoke(testObject,{a:1,b:2});
            assertEquals(testObject.data().a,1);
          }

          function testMethod_2() {
            debug("Testing Method 2...");
            assertEquals(testObject.getClass().getMethod("run").getName(),"run");
            testObject.getClass().getMethod("run").invoke(testObject, function() {
              testDiv.innerText = "Test Method 02";
            }, 1);
            testObject.fire();

            assertEquals("Test Method 02[Initial Text]",testDiv.innerText);
          }
        </script>
    </head>
    <body>
        <h1>Test Reflection</h1>
        <div id="test_div">
        </div>
    </body>
</html>

